"use strict";angular.module("tictactoeApp",["ngAnimate","ngCookies","ngResource","ngRoute","ngSanitize","ngTouch"]).config(["$routeProvider",function(a){a.when("/",{templateUrl:"views/game.html",controller:"GameCtrl"}).otherwise({redirectTo:"/"})}]),angular.module("tictactoeApp").controller("GameCtrl",["$scope","GameLogic","AiLogic","$timeout",function(a,b,c,d){a.board=null,a.announcement=null,a.opponent="AI",a.goesFirst="Me",a.opponentMark="x",a.playerMark="o",a.newGame=function(){if(a.announcement=null,a.gameEnded=!1,a.board=b.newBoard(),a.playerMark="x"===a.opponentMark?"o":"x","Them"===a.goesFirst&&"human"===a.opponent){var d=a.playerMark;a.playerMark=a.opponentMark,a.opponentMark=d}if("AI"===a.opponent&&(c.me=a.opponentMark,c.them=a.playerMark),"Them"===a.goesFirst&&"AI"===a.opponent){var e=c.decideMove(a.board);a.aiMove(e)}},a.gameEnded=!1,a.gameEnd=function(b){b?(a.gameEnded=!0,a.announcement=b+" wins!"):(a.gameEnded=!0,a.announcement="Nobody wins!"),d(function(){a.board=null},3e3)},a.aiMove=function(b){var c=b[0],d=b[1];a.board[c][d].space=a.opponentMark},a.userMove=function(d){var e,f=d.row,g=d.column,h=a.board[f][g].space;if(""===h&&!a.gameEnded)if(a.board[f][g].space=a.playerMark,e=b.won(a.board))a.gameEnd(e);else if(b.draw(a.board))a.gameEnd();else if("AI"===a.opponent){var i=c.decideMove(a.board);a.aiMove(i),e=b.won(a.board),e?a.gameEnd(e):b.draw(a.board)&&a.gameEnd()}else{var j=a.playerMark;a.playerMark=a.opponentMark,a.opponentMark=j}},a.isLast=function(a){return a?"last":null}}]),angular.module("tictactoeApp").factory("GameLogic",function(){var a={};return a.newBoard=function(){return[[{position:{row:0,column:0},space:""},{position:{row:0,column:1},space:""},{position:{row:0,column:2},space:""}],[{position:{row:1,column:0},space:""},{position:{row:1,column:1},space:""},{position:{row:1,column:2},space:""}],[{position:{row:2,column:0},space:""},{position:{row:2,column:1},space:""},{position:{row:2,column:2},space:""}]]},a.allWins=function(){return[[{row:0,column:0},{row:0,column:1},{row:0,column:2}],[{row:1,column:0},{row:1,column:1},{row:1,column:2}],[{row:2,column:0},{row:2,column:1},{row:2,column:2}],[{row:0,column:0},{row:1,column:0},{row:2,column:0}],[{row:0,column:1},{row:1,column:1},{row:2,column:1}],[{row:0,column:2},{row:1,column:2},{row:2,column:2}],[{row:0,column:0},{row:1,column:1},{row:2,column:2}],[{row:0,column:2},{row:1,column:1},{row:2,column:0}]]},a.won=function(a){for(var b=this.allWins(),c=0;c<b.length;c++){var d=b[c],e=this.getCells(a,d);if(this.threeInRow(e))return e[0]}return!1},a.getCells=function(a,b){return b.map(function(b){return a[b.row][b.column].space})},a.draw=function(a){for(var b,c,d,e=0;e<a.length;e++){b=a[e];for(var f=0;f<b.length;f++)if(c=b[f],d=""===c.space)return!1}return!0},a.threeInRow=function(a){var b=a[0],c=a[1],d=a[2];return b===c&&c===d&&""!==b},a}),angular.module("tictactoeApp").factory("AiLogic",function(){var a={};return a.them="x",a.me="o",a.randomElement=function(a){var b=Math.floor(Math.random()*a.length);return a[b]},a.decideMove=function(a){var b=this.me,c=this.them,d=this.hasTwoInARow(a,b),e=this.hasTwoInARow(a,c),f=this.spotFork(a,b),g=this.spotFork(a,c);if(d)return console.log("I win again!"),d[0];if(e)return console.log("They can't win!"),e[0];if(f)return console.log("I will win!"),this.randomElement(f);if(g){if(console.log("They might fork!"),2===g.length){console.log("I will get them!");var h=this.findAgress(a);return this.randomElement(h)}return console.log("I will stop them!"),g[0]}console.log("I'm gonna go here!");var i=this.chooseLegalMove(a);return this.randomElement(i)},a.chooseLegalMove=function(a){for(var b,c,d=this.legalMoves(),e=0;e<d.length;e++)if(c=d[e],b=this.getAvailableMoves(c,a),0!==b.length)return b},a.getAvailableMoves=function(a,b){return a.filter(function(a){return""===b[a[0]][a[1]].space})},a.legalMoves=function(){return[[[1,1]],[[0,0],[0,2],[2,2],[2,0]],[[0,1],[1,2],[2,1],[1,0]]]},a.twoInRow=function(a,b){var c=this.count(a,b),d=this.count(a,""),e=2===c,f=1===d;return e&&f},a.count=function(a,b){var c=a.filter(function(a){return a===b});return c.length},a.considerEmptySpaces=function(a){for(var b,c,d=[],e=0;e<a.length;e++){b=a[e];for(var f=0;f<b.length;f++)c=b[f],""===c.space&&d.push(c.position)}return d},a.findAgress=function(a){for(var b=this.considerEmptySpaces(a),c=[],d=0;d<b.length;d++){var e=b[d],f=angular.copy(a);f[e.row][e.column].space=this.me;var g=this.hasTwoInARow(f,this.me);if(g)for(var h=0;h<g.length;h++){var i=g[h];f[i[0]][i[1]].space=this.them;var j=this.haveFork(f,this.them),k=!j;k&&c.push([e.row,e.column])}}return c},a.hasTwoInARow=function(a,b){for(var c=this.allWins(),d=[],e=0;e<c.length;e++){var f=c[e],g=this.getCells(f,a);if(this.twoInRow(g,b)){var h=g.indexOf(""),i=[f[h].row,f[h].column];d.push(i)}}return 0===d.length?!1:d},a.getCells=function(a,b){return a.map(function(a){return b[a.row][a.column].space})},a.spotFork=function(a,b){for(var c,d,e,f,g,h=this.considerEmptySpaces(a),i=[],j=0;j<h.length;j++)c=h[j],d=angular.copy(a),e=c.row,f=c.column,d[e][f].space=b,g=this.hasTwoInARow(d,b),2===g.length&&i.push([e,f]);return 0!==i.length?i:!1},a.haveFork=function(a,b){var c=this.hasTwoInARow(a,b);return 2===c.length},a.allWins=function(){return[[{row:0,column:0},{row:0,column:1},{row:0,column:2}],[{row:1,column:0},{row:1,column:1},{row:1,column:2}],[{row:2,column:0},{row:2,column:1},{row:2,column:2}],[{row:0,column:0},{row:1,column:0},{row:2,column:0}],[{row:0,column:1},{row:1,column:1},{row:2,column:1}],[{row:0,column:2},{row:1,column:2},{row:2,column:2}],[{row:0,column:0},{row:1,column:1},{row:2,column:2}],[{row:0,column:2},{row:1,column:1},{row:2,column:0}]]},a});